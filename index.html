<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Judge Randomizer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --bg: #f7f9fc;
      --card-bg: #fff;
      --accent: #f1f5fb;
      --border: #e5e7eb;
      --shadow: 0 4px 24px rgba(34, 60, 80, 0.08);
      --radius: 18px;
      --input-bg: #f1f5fb;
      --input-border: #d1d5db;
      --danger: #ef4444;
      --success: #22c55e;
    }
    html, body {
      font-family: 'Inter', 'Poppins', Arial, sans-serif;
      background: var(--bg);
      color: #222;
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    .logo {
      margin: 18px 0 8px 0;
      text-align: center;
    }
    .logo img {
      max-width: 200px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(34,60,80,0.10);
    }
    .logo h1 {
      font-weight: 600;
      font-size: 2.3rem;
      color: var(--primary);
      margin: 0 0 8px 0;
      letter-spacing: -1px;
      text-align: center;
    }
    .container {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 40px 28px 32px 28px;
      max-width: 950px;
      margin: 24px auto 36px auto;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 20px;
    }
    label {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 6px;
      color: var(--primary-dark);
    }
    textarea, input[type="text"], select {
      width: 100%;
      padding: 11px 14px;
      margin: 5px 0 15px 0;
      border-radius: 10px;
      border: 1.5px solid var(--input-border);
      background: var(--input-bg);
      font-size: 1rem;
      transition: border-color .2s;
      outline: none;
      box-sizing: border-box;
      resize: vertical;
    }
    textarea:focus, input[type="text"]:focus, select:focus {
      border-color: var(--primary);
      background: #e0e7ff;
    }
    button {
      background-color: var(--primary);
      color: #fff;
      border: none;
      padding: 13px 26px;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      margin-right: 12px;
      margin-top: 6px;
      box-shadow: 0 2px 6px rgba(37,99,235,0.07);
      transition: background 0.2s, transform 0.1s;
      outline: none;
    }
    button:hover, button:focus {
      background-color: var(--primary-dark);
      transform: translateY(-2px) scale(1.03);
    }
    button[style*="background:#ff6b6b;"] {
      background: var(--danger)!important;
    }
    button[style*="background:#555;"] {
      background: #374151!important;
    }
    .controls {
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
      margin-bottom: 18px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 18px;
    }
    #permanentBox {
      width: 100%;
      background: var(--accent);
      border: 1.5px solid var(--primary);
      border-radius: 14px;
      padding: 18px 10px 12px 10px;
      margin-bottom: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: flex-start;
      box-sizing: border-box;
    }
    #permanentBox input {
      width: 180px;
      font-size: 0.96rem;
      margin-bottom: 2px;
      background: #fff;
      border: 1px solid var(--input-border);
    }
    #panelBPerms {
      display: flex;
      gap: 10px;
    }
    .results {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 22px;
      width: 100%;
      justify-content: space-between;
    }
    .column {
      flex: 1 1 270px;
      min-width: 240px;
      background: var(--accent);
      border-radius: 12px;
      padding: 14px 12px 16px 12px;
      box-sizing: border-box;
      box-shadow: 0 1px 7px rgba(34, 60, 80, 0.06);
      margin-bottom: 12px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    .column h3 {
      text-align: center;
      border-bottom: 1.5px solid var(--primary);
      padding-bottom: 4px;
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 10px;
      color: var(--primary);
      letter-spacing: -0.5px;
    }
    .list {
      background: #f9fafb;
      border-radius: 10px;
      padding: 8px;
      min-height: 140px;
      transition: all 0.3s ease;
      font-size: 1rem;
      box-shadow: 0 1px 3px rgba(37,99,235,0.04);
    }
    .list div {
      background: #e0e7ff;
      margin: 6px 0;
      padding: 8px 12px;
      border-radius: 7px;
      font-size: 1rem;
      transition: background 0.2s, transform 0.2s;
      box-shadow: 0 1px 3px rgba(37,99,235,0.04);
    }
    .list div.active {
      background: #c7d2fe;
      font-weight: bold;
      transform: scale(1.03);
    }
    .panelA div { background-color: #dbeafe; }
    .panelB div { background-color: #bbf7d0; }
    .break div { background-color: #fde68a; }
    .current-countdown {
      float: right;
      font-weight: 600;
      color: var(--primary-dark);
      font-size: 0.95em;
      letter-spacing: 0.1em;
    }
    @media (max-width: 1000px) {
      .container { max-width: 99vw; }
      .results { flex-direction: column; gap: 16px; }
      .column { width: 100%; min-width: unset; }
    }
    @media (max-width: 700px) {
      .container { padding: 20px 2vw 14px 2vw; }
      #permanentBox { flex-direction: column; align-items: stretch; }
      #permanentBox input { width: 100%; }
      .column { padding: 10px 4px 12px 4px; }
      .list { font-size: 0.98rem; }
    }
  </style>
</head>
<body>
  <div class="logo">
    <h1>Judge Randomizer</h1>
    <img src="https://bulacro.com/wp-content/uploads/2022/04/cropped-cropped-logo.png" alt="Logo">
  </div>
  <div class="container">

    <div class="controls">
      <label>Number of Panels:</label>
      <select id="panelSelect" onchange="togglePanelB()">
        <option value="1">Panel A only</option>
        <option value="2">Panel A + Panel B</option>
      </select>

      <label>All Judges (one per line):</label>
      <textarea id="judgesInput" placeholder="Judge 1&#10;Judge 2&#10;Judge 3"></textarea>

      <div>
        <button onclick="startShuffle()">Start Shuffle</button>
        <button onclick="stopShuffle()" style="background:#ff6b6b;">Stop</button>
        <button onclick="resetAll()" style="background:#555;">Reset</button>
      </div>
    </div>

    <div id="permanentBox">
      <input type="text" id="genJudge" placeholder="General Judge (independent)">
      <input type="text" id="cjp1" placeholder="CJP1">
      <input type="text" id="dj1" placeholder="DJ1">
      <input type="text" id="dj2" placeholder="DJ2">
      <div id="panelBPerms" style="display:flex;gap:10px;">
        <input type="text" id="cjp2" placeholder="CJP2">
        <input type="text" id="dj3" placeholder="DJ3">
        <input type="text" id="dj4" placeholder="DJ4">
      </div>
    </div>

    <div class="results">
      <div class="column">
        <h3>Panel A</h3>
        <div id="panelAList" class="list panelA"></div>
      </div>
      <div class="column" id="panelBColumn" style="display:none;">
        <h3>Panel B</h3>
        <div id="panelBList" class="list panelB"></div>
      </div>
      <div class="column">
        <h3>Break Judges</h3>
        <div id="breakList" class="list break"></div>
      </div>
    </div>

  </div>
  <script>
    // all your original JS unchanged
    const PASSWORD = "1234";
    const panelAPositions = ["E1","E2","E3","E4","A1","A2","A3","A4"];
    const panelBPositions = ["E1","E2","E3","E4","A1","A2","A3","A4"];
    let stopFlag = false;

    function togglePanelB() {
      const panelB = document.getElementById("panelBColumn");
      const panelBPerms = document.getElementById("panelBPerms");
      if(document.getElementById("panelSelect").value==="2") {
        panelB.style.display="block";
        panelBPerms.style.display="flex";
      } else {
        panelB.style.display="none";
        panelBPerms.style.display="none";
      }
    }

    function resetAll(){
      stopFlag = true;
      document.getElementById("panelAList").innerHTML="";
      document.getElementById("panelBList").innerHTML="";
      document.getElementById("breakList").innerHTML="";
    }

    function stopShuffle(){
      stopFlag = true;
    }

    async function startShuffle() {
      stopFlag = false;
      const pwd = prompt("Enter password:");
      if(pwd!==PASSWORD){ alert("❌ Wrong password!"); return; }

      const allJudges = document.getElementById("judgesInput").value.split(/\n/).map(j=>j.trim()).filter(j=>j);

      const genJudge = document.getElementById("genJudge").value.trim();
      const cjp1 = document.getElementById("cjp1").value.trim();
      const dj1 = document.getElementById("dj1").value.trim();
      const dj2 = document.getElementById("dj2").value.trim();

      const panelAList = document.getElementById("panelAList");
      const panelBList = document.getElementById("panelBList");
      const breakList = document.getElementById("breakList");

      panelAList.innerHTML=""; panelBList.innerHTML=""; breakList.innerHTML="";

      function shuffle(array) { return array.sort(() => Math.random() - 0.5); }

      // PANEL A ASSIGNMENT
      let availableA = shuffle([...allJudges]);
      let panelAAssigned = availableA.slice(0, panelAPositions.length);
      let leftovers = availableA.slice(panelAPositions.length);
      for(let i=0;i<panelAAssigned.length;i++){
        const div = document.createElement("div");
        div.innerHTML = panelAPositions[i]+": "+panelAAssigned[i]+" <span class='current-countdown'></span>";
        panelAList.appendChild(div);
        await revealCountdown(div);
        if(stopFlag) return;
      }

      // PANEL B IF SELECTED
      if(document.getElementById("panelSelect").value==="2"){
        const cjp2 = document.getElementById("cjp2").value.trim();
        const dj3 = document.getElementById("dj3").value.trim();
        const dj4 = document.getElementById("dj4").value.trim();

        let availableB = shuffle([...leftovers]);
        let panelBAssigned = availableB.slice(0, panelBPositions.length);
        leftovers = availableB.slice(panelBPositions.length);

        for(let i=0;i<panelBAssigned.length;i++){
          const div = document.createElement("div");
          div.innerHTML = panelBPositions[i]+": "+panelBAssigned[i]+" <span class='current-countdown'></span>";
          panelBList.appendChild(div);
          await revealCountdown(div);
          if(stopFlag) return;
        }
      }

      // LEFTOVERS TO BREAK JUDGES
      leftovers.forEach(j=>{if(j){const div=document.createElement("div"); div.textContent=j; breakList.appendChild(div);}});

      // GENERAL JUDGE
      if(genJudge){
        const div = document.createElement("div");
        div.style.fontWeight="bold";
        div.textContent = "General Judge: "+genJudge;
        breakList.prepend(div);
      }

      alert("✅ Shuffle complete!");
    }

    async function revealCountdown(div){
      const countdownSpan = div.querySelector(".current-countdown");
      for(let sec=5; sec>0; sec--){
        if(stopFlag) break;
        if(countdownSpan) countdownSpan.textContent = `(${sec}s)`;
        await new Promise(r=>setTimeout(r,1000));
      }
      if(countdownSpan) countdownSpan.textContent="";
    }
  </script>
</body>
</html>
